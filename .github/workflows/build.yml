name: Cross-Platform Executable Build

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  # ---------------------------------
  # Windows ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–
  # ---------------------------------
  build_windows:
    runs-on: windows-latest
    steps:
    - name: ğŸ“ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
    - name: ğŸ Python 3.11ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: pip install -r requirements.txt
    - name: ğŸ› ï¸ PyInstallerã§Windowså‘ã‘ã«ãƒ“ãƒ«ãƒ‰
      # Windowsã®Runnerã§ build_win.spec ã‚’ä½¿ã†
      run: pyinstaller build_win.spec
    - name: ğŸš€ Windowsæˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: queue-api-windows-exe
        path: dist/queue_api_win.exe

  # ---------------------------------
  # Mac ãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 
  # ---------------------------------
  build_macos:
    runs-on: macos-latest # Macç”¨ã®Runnerã‚’ä½¿ã†
    steps:
    - name: ğŸ“ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
    - name: ğŸ Python 3.11ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    # build_mac.spec ã‚’ä½¿ã†ãŸã‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
    - name: ğŸ“ Macç”¨ spec ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
      run: |
        # ã“ã“ã§ build_mac.spec ã®ä¸­èº«ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™ã‹ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠã
        # (ä»Šå›ã¯ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãŸå‰æã§é€²ã‚ã‚‹)
        echo "using existing build_mac.spec"
    - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: pip install -r requirements.txt
    - name: ğŸ› ï¸ PyInstallerã§Macå‘ã‘ã«ãƒ“ãƒ«ãƒ‰
      # Macã®Runnerã§ build_mac.spec ã‚’ä½¿ã†
      run: pyinstaller build_mac.spec
    - name: ğŸš€ Macæˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: queue-api-macos-exe
        # Macã§ã¯æ‹¡å¼µå­ãªã—ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
        path: dist/queue_api_mac
