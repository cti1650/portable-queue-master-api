# Makefile - Portable Queue Master (PQMaster) のDocker操作コマンド

# .PHONY: 偽ターゲット。ファイル名との衝突を防ぎ、実行を高速化する
.PHONY: up down clean help

# ----------------------------------------------------
# 1. サーバーの立ち上げ (make up)
# ----------------------------------------------------
up:
	@echo "--- 開発環境を構築し、サーバーを起動します (http://localhost:8000/) ---"
	docker compose up -d --build
	@echo "✅ サーバー起動完了！ http://localhost:8000/"

# ----------------------------------------------------
# 2. 環境を汚さない安全な停止 (make down)
# ----------------------------------------------------
down:
	@echo "--- サーバーを安全に停止・コンテナを削除します ---"
	docker compose down
	@echo "✅ サーバー停止完了。データ（ボリューム）は残っています。"

# ----------------------------------------------------
# 3. 完全削除（初期状態に戻す） (make clean)
# ----------------------------------------------------
clean:
	@echo "--- コンテナ、イメージ、永続化データ（ボリューム）を完全に削除し、初期状態に戻します ---"
	# 💡 【改善点】コンテナ、ネットワーク、イメージ、そしてデータボリュームをすべて削除
	docker compose down --rmi all -v
	@echo "🔥 環境の完全削除が完了しました。データディレクトリのゴミは残りません。"

# ----------------------------------------------------
# ヘルプ表示 (make help)
# ----------------------------------------------------
help:
	@echo "======================================================"
	@echo " Portable Queue Master (PQMaster) Docker コマンド集"
	@echo "======================================================"
	@echo "make up     : 環境構築＆サーバー起動 (http://localhost:8000/)"
	@echo "make down   : サーバーを安全に停止・コンテナ削除 (データは残る)"
	@echo "make clean  : downを実行後、データ(ボリューム)とDockerイメージを完全に削除し初期化"
	@echo "make help   : このヘルプを表示"